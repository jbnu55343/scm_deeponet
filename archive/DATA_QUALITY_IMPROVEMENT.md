ğŸ“‹ æ•°æ®è´¨é‡æ”¹è¿›æ–¹æ¡ˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€é—®é¢˜åˆ†æã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å½“å‰ postprocess_with_lags.py çš„è¡Œä¸ºï¼š
  âœ“ å®ƒè¯»å– edgedata.xml ä¸­çš„æ‰€æœ‰æ—¶é—´æ­¥ï¼ˆ0-24hï¼‰
  âœ“ å®ƒæ·»åŠ æ—¶é—´æ»å (lag 1-12)
  âœ“ å®ƒå¯¹é½æ•°æ®å»æ‰å‰ 12 è¡Œï¼ˆç”¨äº lagï¼‰å’Œæœ€å 1 è¡Œï¼ˆç”¨äº horizonï¼‰
  
  ä½†æ˜¯å®ƒ âŒ æ²¡æœ‰è¿‡æ»¤æ‰å…¨ 0 æ—¶é—´æ­¥

ç»“æœï¼š
  â€¢ åŒ…å« 0-8h çš„å®Œå…¨æ— æ•ˆæ•°æ®ï¼ˆæ²¡æœ‰è½¦è¾†ï¼‰
  â€¢ æ¨¡å‹ä¼šå­¦åˆ°å™ªå£°è€Œä¸æ˜¯çœŸå®æµé‡è§„å¾‹
  â€¢ æ•°æ®è´¨é‡ä¸‹é™


ã€æ”¹è¿›æ–¹æ¡ˆã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ read_edgedata_xml() ä¹‹åæ·»åŠ ï¼š

```python
def filter_zero_intervals(X, times, threshold_ratio=0.05):
    """
    è¿‡æ»¤æ‰å…¨æˆ–å‡ ä¹å…¨ 0 çš„æ—¶é—´æ­¥
    
    Args:
        X: (T, E, F) ç‰¹å¾å¼ é‡
        times: (T,) æ—¶é—´æˆ³
        threshold_ratio: å¦‚æœä¸€ä¸ªæ—¶é—´æ­¥æœ‰ 95% ä»¥ä¸Šçš„è¾¹æ•°æ®ä¸º 0ï¼Œè§†ä¸ºæ— æ•ˆ
    
    Returns:
        X_valid, times_valid, first_valid_idx
    """
    T, E, F = X.shape
    
    # è®¡ç®—æ¯ä¸ªæ—¶é—´æ­¥çš„æœ‰æ•ˆè¾¹æ•°ï¼ˆé€Ÿåº¦ > 0ï¼‰
    # å‡è®¾ç¬¬ä¸€ä¸ªç‰¹å¾æ˜¯é€Ÿåº¦
    valid_edges_per_t = np.sum(X[:, :, 0] > 0, axis=1)  # (T,)
    
    # æ‰¾åˆ°æœ‰æ•ˆçš„æ—¶é—´æ­¥ï¼ˆè‡³å°‘ 5% çš„è¾¹æœ‰æ•°æ®ï¼‰
    valid_threshold = int(E * threshold_ratio)
    valid_mask = valid_edges_per_t >= valid_threshold
    
    first_valid_idx = np.where(valid_mask)[0]
    if len(first_valid_idx) == 0:
        print("[WARN] æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆæ—¶é—´æ­¥ï¼")
        return X, times, 0
    
    first_valid_idx = first_valid_idx[0]
    
    print(f"[INFO] ä¸¢å¼ƒå‰ {first_valid_idx} ä¸ªæ— æ•ˆæ—¶é—´æ­¥")
    print(f"       æ—¶é—´èŒƒå›´: {times[0]:.1f}s åˆ° {times[first_valid_idx]:.1f}s")
    print(f"       å°æ—¶èŒƒå›´: {times[0]/3600:.2f}h åˆ° {times[first_valid_idx]/3600:.2f}h")
    
    X_valid = X[first_valid_idx:]
    times_valid = times[first_valid_idx:]
    
    return X_valid, times_valid, first_valid_idx
```

ä½¿ç”¨æ–¹å¼ï¼š

```python
# åœ¨ read_edgedata_xml() ä¹‹å
for edge_id in edges:
    # ... æå–ç‰¹å¾ ...

# å…³é”®ï¼šè¿‡æ»¤å…¨ 0 éƒ¨åˆ†
X_tef, times, skip_idx = filter_zero_intervals(X_tef, times)
if skip_idx > 0:
    print(f"âœ“ æˆåŠŸè¿‡æ»¤ï¼Œä¿ç•™äº† {X_tef.shape[0]} ä¸ªæ—¶é—´æ­¥")
```


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å…·ä½“ä¿®æ”¹ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ–‡ä»¶: scripts/postprocess_with_lags.py

ä½ç½® 1: åœ¨å‡½æ•°å®šä¹‰åŒºæ·»åŠ  filter_zero_intervals()

ä½ç½® 2: åœ¨ read_edgedata_xml() è¿”å›å¤„è°ƒç”¨è¿‡æ»¤


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å®æ–½è®¡åˆ’ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ–¹æ¡ˆ A: å¿«é€Ÿä¿®å¤ï¼ˆ5 åˆ†é’Ÿï¼‰
  â€¢ åœ¨ build_one_scenario() ä¸­æ·»åŠ ç®€å•çš„è¿‡æ»¤
  â€¢ åªè¿‡æ»¤æ‰é€Ÿåº¦å…¨ 0 çš„è¡Œ
  
æ–¹æ¡ˆ B: å®Œæ•´æ”¹è¿›ï¼ˆ15 åˆ†é’Ÿï¼‰
  â€¢ åœ¨ read_edgedata_xml() ä¸­æ·»åŠ å®Œæ•´çš„è¿‡æ»¤å‡½æ•°
  â€¢ æ”¯æŒå¯é…ç½®çš„é˜ˆå€¼
  â€¢ è¾“å‡ºæ—¥å¿—
  
å»ºè®®: å…ˆç”¨æ–¹æ¡ˆ Aï¼Œå¿«é€ŸéªŒè¯æ•ˆæœ


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å¿«é€Ÿå®æ–½ (æ–¹æ¡ˆ A)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ build_one_scenario() å‡½æ•°ä¸­ï¼Œè¯»å–å®Œ edgedata.xml åï¼š

```python
# ===== å½“å‰ä»£ç  =====
X_tef = ... # (T, E, F)
times = ... # (T,)

# ===== æ·»åŠ è¿™å‡ è¡Œ =====
# è¿‡æ»¤æ‰å…¨ 0 çš„æ—¶é—´æ­¥
zero_mask = np.sum(X_tef, axis=(1, 2)) == 0
if np.any(zero_mask):
    first_valid = np.where(~zero_mask)[0][0]
    print(f"[INFO] {sdir.name}: ä¸¢å¼ƒå‰ {first_valid} ä¸ªå…¨ 0 æ—¶é—´æ­¥ "
          f"({times[first_valid]/3600:.2f}h)")
    X_tef = X_tef[first_valid:]
    times = times[first_valid:]
```

ç„¶åç»§ç»­åŸæœ‰é€»è¾‘ï¼š
```python
# ç”Ÿæˆ yï¼Œå¹¶å¯¹é½ï¼ˆå»æ‰å‰ max_lag è¡Œä¸æœ€å horizon è¡Œï¼‰
max_lag = max(lags) if lags else 0
valid_t_start = max_lag
...
```


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€é¢„æœŸæ•ˆæœã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ä¿®æ”¹å‰:
  â€¢ æ•°æ®æ—¶é—´èŒƒå›´: 0-24 å°æ—¶
  â€¢ åŒ…å«å…¨ 0 æ•°æ®: 0-8 å°æ—¶ï¼ˆ~2880 ä¸ªæ—¶é—´æ­¥ï¼‰
  â€¢ æœ‰æ•ˆæ•°æ®: 8-24 å°æ—¶ï¼ˆ~5760 ä¸ªæ—¶é—´æ­¥ï¼‰
  â€¢ æ•°æ®è´¨é‡: âš ï¸ ä¸­ç­‰ï¼ˆæœ‰å™ªå£°ï¼‰

ä¿®æ”¹å:
  â€¢ æ•°æ®æ—¶é—´èŒƒå›´: 8-24 å°æ—¶ï¼ˆå»æ‰å‰ 8 å°æ—¶ï¼‰
  â€¢ åŒ…å«å…¨ 0 æ•°æ®: æ—  âœ“
  â€¢ æœ‰æ•ˆæ•°æ®: å…¨éƒ¨ âœ“
  â€¢ æ•°æ®è´¨é‡: âœ… ä¼˜ç§€

æ€§èƒ½æ”¹è¿›é¢„æœŸ:
  â€¢ æ¨¡å‹æ”¶æ•›é€Ÿåº¦: æ›´å¿«
  â€¢ æ¨¡å‹æ€§èƒ½: æ›´å¥½ï¼ˆä¸å†å­¦ä¹ è™šå‡çš„"æ— æµé‡"ç‰¹å¾ï¼‰
  â€¢ è®­ç»ƒç¨³å®šæ€§: æ›´ç¨³å®š


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€éªŒè¯æ–¹æ³•ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ä¿®æ”¹åéªŒè¯æ•ˆæœï¼š

1. å†æ¬¡è¿è¡Œ run_spatial_comparison.py
2. æ£€æŸ¥æ—¥å¿—è¾“å‡ºæ˜¯å¦åŒ…å«:
   [INFO] S001: ä¸¢å¼ƒå‰ XXX ä¸ªå…¨ 0 æ—¶é—´æ­¥ (Y.YYh)
   
3. éªŒè¯æ•°æ®:
   python -c "
import numpy as np
data = np.load('data/dataset_sumo_5km_lag12_no_spatial.npz')
X = data['X']
print('æ•°æ®å½¢çŠ¶:', X.shape)
print('æ˜¯å¦åŒ…å«å…¨ 0 è¡Œ:', np.any(np.sum(X, axis=1) == 0))
print('é€Ÿåº¦èŒƒå›´:', X.min(), '-', X.max())
"

4. é¢„æœŸè¾“å‡º:
   æ•°æ®å½¢çŠ¶: (N, 16974, 85)
   æ˜¯å¦åŒ…å«å…¨ 0 è¡Œ: False  â† âœ“ æ²¡æœ‰å…¨ 0 è¡Œï¼
   é€Ÿåº¦èŒƒå›´: 0.0 - 150.0


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€æˆ‘çš„å»ºè®®ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… ç«‹å³æ‰§è¡Œè¿™ä¸ªæ”¹è¿›ï¼š
  1. æ‰“å¼€ scripts/postprocess_with_lags.py
  2. æ‰¾åˆ°ç¬¬ 80-100 è¡Œï¼ˆread_edgedata_xml è¿”å›å¤„ï¼‰
  3. åœ¨ times = ... åæ·»åŠ è¿‡æ»¤ä»£ç 
  4. ä¿å­˜æ–‡ä»¶
  5. é‡æ–°è¿è¡Œ python run_spatial_comparison.py

âœ… åŒæ—¶ä¿®æ”¹ postprocess_with_lags_spatial.py
  ç¡®ä¿å®ƒä¹Ÿæœ‰ç›¸åŒçš„è¿‡æ»¤é€»è¾‘

ç»“æœï¼š
  â€¢ æ•°æ®è´¨é‡æ˜¾è‘—æå‡
  â€¢ æ¨¡å‹è®­ç»ƒæ•ˆæœæ›´å¥½
  â€¢ è®ºæ–‡æ›´æœ‰è¯´æœåŠ›ï¼ˆ"æˆ‘ä»¬ç²¾å¿ƒç­›é€‰äº†æœ‰æ•ˆçš„æµé‡æ•°æ®"ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
